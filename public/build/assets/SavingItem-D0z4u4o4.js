import{j as e,r as p,K as k,$ as z,L as B}from"./app-DAVo1ZCX.js";import{C}from"./PriceConvert-BmHzhQr-.js";import{a as _,I}from"./InputPrice-CPVIe5kc.js";import{M as $}from"./Modal-CxTWkXlq.js";import{I as L}from"./InputText-DRg0KAk2.js";import{P as O}from"./PrimaryButton-Ch-iIH9j.js";import{A as D}from"./AuthenticatedLayout-DrQqtw57.js";import{F}from"./FarstView-CQ-xgfLG.js";import"./transition-D0Iw2xOQ.js";import"./dialog-Dl0bj6jO.js";import"./ApplicationLogo-CysFKZ0f.js";function A({className:o="",title:n,type:a,...l}){const s={1:"primary-500",2:"pink-500",3:"orange-500"}[a],r={1:"長",2:"中",3:"短"}[a];return e.jsxs("div",{className:"relative flex flex-nowrap items-center justify-center gap-1 mt-8 w-full border-b-4 border-dotted pb-2"+o,children:[e.jsx("span",{className:`inline-flex items-center justify-center px-1 py-1 text-${s} border-2 border-${s} leading-none font-bold text-sm rounded-sm dark:bg-black/95`,children:r}),e.jsx("h3",{className:"inline-block py-1 w-auto text-lg font-bold leading-none focus:outline-none "+o,children:n})]})}function R({amount:o,total:n,size:a}){const r=o/n*100,t={small:"h-1",large:"h-8"}[a];return e.jsx("div",{className:"overflow-hidden w-full bg-gray-300 rounded-sm "+t,children:e.jsx("div",{className:"h-full bg-gradation",style:{width:`${r}%`,transition:"width 0.5s ease"}})})}function H({type:o="submit",className:n="",disabled:a,...l}){const[s,r]=p.useState(!1),t=()=>{s||(r(!0),setTimeout(()=>r(!1),500))},i=c=>{t(),l.onClick&&l.onClick(c)};return e.jsxs("button",{...l,type:o,onClick:i,className:`button-savig inline-flex flex-col items-center justify-center gap-0 rounded-full w-20 h-20 border border-primary-500 bg-primary-500 text-sm font-bold uppercase tracking-normal text-white shadow-sm transition duration-150 ease-in-out hover:bg-gradation-blue hover:border-blue hover:text-white focus:outline-none focus:ring-2 focus:ring-blue focus:ring-offset-2 ${a&&"opacity-25 pointer-events-none"} `+n,disabled:a,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 512 512",className:`object-contain ${s?"animate-bounceSvg":""}`,children:e.jsx("path",{d:"M512 80c0 18-14.3 34.6-38.4 48c-29.1 16.1-72.5 27.5-122.3 30.9c-3.7-1.8-7.4-3.5-11.3-5C300.6 137.4 248.2 128 192 128c-8.3 0-16.4 .2-24.5 .6l-1.1-.6C142.3 114.6 128 98 128 80c0-44.2 86-80 192-80S512 35.8 512 80zM160.7 161.1c10.2-.7 20.7-1.1 31.3-1.1c62.2 0 117.4 12.3 152.5 31.4C369.3 204.9 384 221.7 384 240c0 4-.7 7.9-2.1 11.7c-4.6 13.2-17 25.3-35 35.5c0 0 0 0 0 0c-.1 .1-.3 .1-.4 .2c0 0 0 0 0 0s0 0 0 0c-.3 .2-.6 .3-.9 .5c-35 19.4-90.8 32-153.6 32c-59.6 0-112.9-11.3-148.2-29.1c-1.9-.9-3.7-1.9-5.5-2.9C14.3 274.6 0 258 0 240c0-34.8 53.4-64.5 128-75.4c10.5-1.5 21.4-2.7 32.7-3.5zM416 240c0-21.9-10.6-39.9-24.1-53.4c28.3-4.4 54.2-11.4 76.2-20.5c16.3-6.8 31.5-15.2 43.9-25.5l0 35.4c0 19.3-16.5 37.1-43.8 50.9c-14.6 7.4-32.4 13.7-52.4 18.5c.1-1.8 .2-3.5 .2-5.3zm-32 96c0 18-14.3 34.6-38.4 48c-1.8 1-3.6 1.9-5.5 2.9C304.9 404.7 251.6 416 192 416c-62.8 0-118.6-12.6-153.6-32C14.3 370.6 0 354 0 336l0-35.4c12.5 10.3 27.6 18.7 43.9 25.5C83.4 342.6 135.8 352 192 352s108.6-9.4 148.1-25.9c7.8-3.2 15.3-6.9 22.4-10.9c6.1-3.4 11.8-7.2 17.2-11.2c1.5-1.1 2.9-2.3 4.3-3.4l0 3.4 0 5.7 0 26.3zm32 0l0-32 0-25.9c19-4.2 36.5-9.5 52.1-16c16.3-6.8 31.5-15.2 43.9-25.5l0 35.4c0 10.5-5 21-14.9 30.9c-16.3 16.3-45 29.7-81.3 38.4c.1-1.7 .2-3.5 .2-5.3zM192 448c56.2 0 108.6-9.4 148.1-25.9c16.3-6.8 31.5-15.2 43.9-25.5l0 35.4c0 44.2-86 80-192 80S0 476.2 0 432l0-35.4c12.5 10.3 27.6 18.7 43.9 25.5C83.4 438.6 135.8 448 192 448z"})}),"ちょきん"]})}function E({className:o="",onChange:n,onSave:a,inputName:l}){const[s,r]=p.useState(0),t=c=>{const m=Number(c.target.value);r(m),n(m)};p.useRef(null);const i=()=>{a(s)};return e.jsxs("div",{className:`flex items-center justify-start flex-col gap-4 ${o}`,children:[e.jsx("div",{className:"flex items-center justify-start gap-1 mb-1",children:e.jsx(_,{className:"max-w-80",name:l,value:s,onChange:t})}),e.jsx(H,{onClick:i})]})}function q({goal_id:o,category:n,setIsOpen:a}){const{auth:l}=k().props,s=l.user,r=new Date().toISOString().slice(0,10),[t,i]=p.useState({memo:"",amount:0,goal_id:o,category:n,date:r}),c=(u,h)=>{i(d=>({...d,[h]:u}))},m=async u=>{u.preventDefault();const h=`しようりれき：${t.memo}`,d=new FormData;d.append("memo",h),d.append("amount",(t.amount*-1).toString()),d.append("goal_id",t.goal_id.toString()),d.append("category",t.category.toString()),d.append("date",t.date),d.append("user_id",s.id.toString()),d.append("is_shared","0");try{const f=await fetch("/saving/paid/",{method:"POST",headers:{"X-CSRF-TOKEN":b.current},body:d});if(f.ok)i({memo:"",amount:0,date:r,goal_id:o,category:n}),a(!1);else{const y=await f.text()}}catch{alert("通信エラーが発生しました。")}},j=document.querySelector("meta[name='csrf-token']"),b=p.useRef(j.content);return e.jsx("div",{className:"px-4 py-6",children:e.jsxs("form",{onSubmit:m,children:[e.jsx("input",{type:"hidden",name:"user_id",value:s.id}),e.jsx("input",{type:"hidden",name:"category",value:1}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"font-bold text-gray-400",children:"なにに使った？"}),e.jsx(L,{type:"text",id:"memo",name:"memo",value:t.memo,onChange:u=>c(u.target.value,"memo"),placeholder:"タイトルを入力",className:"w-full mt-1 text-black placeholder:italic placeholder:text-darkgray focus:outline-2 focus:outline-purple"})]}),e.jsxs("label",{className:"flex flex-col gap-2 pt-4",children:[e.jsx("span",{className:"font-bold text-gray-400",children:"なにに使った？"}),e.jsx(I,{type:"date",id:"date",name:"date",value:t.date,className:"w-full mt-1 text-black placeholder:italic placeholder:text-darkgray focus:outline-2 focus:outline-purple",onChange:u=>c(u.target.value,"date")})]}),e.jsxs("label",{className:"flex flex-col gap-2 pt-4",children:[e.jsx("span",{className:"font-bold text-gray-400",children:"いくら使った？"}),e.jsx(_,{type:"text",id:"amount",name:"amount",value:t.amount,onChange:u=>c(Number(u.target.value),"amount"),placeholder:"（例）2000円",className:"w-full mt-1 text-black placeholder:italic placeholder:text-darkgray focus:outline-2 focus:outline-purple"})]}),e.jsx("div",{className:"flex justify-center w-auto mx-auto mt-4",children:e.jsx(O,{type:"submit",children:"登録"})})]})})}function K({type:o="button",className:n="",disabled:a,goal_id:l,category:s,...r}){const[t,i]=p.useState(!1),c=()=>i(!0),m=()=>i(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{...r,type:o,onClick:c,className:`button-icon ${a?"opacity-25 pointer-events-none":""} ${n}`,disabled:a,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 576 512",className:"w-auto h-4",children:e.jsx("path",{d:"M253.3 35.1c6.1-11.8 1.5-26.3-10.2-32.4s-26.3-1.5-32.4 10.2L117.6 192 32 192c-17.7 0-32 14.3-32 32s14.3 32 32 32L83.9 463.5C91 492 116.6 512 146 512L430 512c29.4 0 55-20 62.1-48.5L544 256c17.7 0 32-14.3 32-32s-14.3-32-32-32l-85.6 0L365.3 12.9C359.2 1.2 344.7-3.4 332.9 2.7s-16.3 20.6-10.2 32.4L404.3 192l-232.6 0L253.3 35.1zM192 304l0 96c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-96c0-8.8 7.2-16 16-16s16 7.2 16 16zm96-16c8.8 0 16 7.2 16 16l0 96c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-96c0-8.8 7.2-16 16-16zm128 16l0 96c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-96c0-8.8 7.2-16 16-16s16 7.2 16 16z"})}),"使った"]}),t&&e.jsx($,{show:t,onClose:m,maxWidth:"lg",children:e.jsx(q,{goal_id:l,category:s,setIsOpen:m})})]})}function ne(){const{auth:o,statuses:n,savings:a,histories:l}=k().props,s=o.user;if(!((n==null?void 0:n[s.id])??null)||!a)return e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden bg-white shadow-sm sm:rounded-lg",children:e.jsx("div",{className:"flex items-center justify-center gap-2 w-full h-screen",children:e.jsx(z,{href:"./registration",className:"flex items-center justify-center rounded-md border border-transparent bg-gradation min-w-32 max-w-52 px-4 py-2 max-h-10 text-sm font-bold uppercase tracking-widest text-white transition duration-150 ease-in-out hover:bg-gradation-blue focus:bg-gradation focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 active:bg-gradation",children:"初回登録した？"})})})});const t={id:a.id,comment_id:a.comment_id,user_id:a.user_id,goal_id:a.id,title:a.title,amount:a.amount,deadline:a.deadline,achieve:a.achieve,level:a.level,images:a.images,is_shared:a.is_shared,memo:a.memo},i=(l==null?void 0:l.filter(x=>x.user_id===s.id))??[],c=(x,g)=>g.filter(v=>v.goal_id===x).reduce((v,T)=>{const S=parseFloat(String(T.amount));return v+(isNaN(S)?0:S)},0),[m,j]=p.useState(c(t.id,i)),[b,u]=p.useState(0),[h,d]=p.useState(0),f=x=>{u(x)},y=x=>{const g=x+c(t.id,i);d(g),j(g)},w=new Date(t.deadline).toISOString().split("T")[0],P=document.querySelector("meta[name='csrf-token']"),M=p.useRef(P.content),N="貯金";return e.jsxs(D,{header:e.jsx("h1",{className:"w-full flex items-center justify-center text-xl font-semibold leading-tight text-gray-800",children:N}),children:[e.jsx(B,{title:N}),e.jsx(F,{category:1}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(A,{type:1,title:t.title}),e.jsxs("p",{className:"flex items-center gap-2 text-sm font-bold",children:[e.jsx("span",{className:"inline-flex px-2 py-1 bg-gray-500 rounded-2xl text-white font-bold",children:"目標達成予定日"}),w]}),t.memo&&e.jsxs("p",{className:"my-4 text-center text-sm",children:[e.jsx("span",{className:"inline-block bg-slate-600 text-white rounded-2xl py-0 px-2 mr-1 font-bold",children:"メモ"}),t.memo]}),e.jsxs("form",{action:"/saving/update",method:"POST",children:[e.jsx("input",{type:"hidden",name:"_token",value:M.current}),e.jsx("input",{type:"hidden",name:"id",value:t.id}),e.jsx("input",{type:"hidden",name:"user_id",value:s.id}),e.jsx("input",{type:"hidden",name:"category",value:1}),e.jsx("input",{type:"hidden",name:"goal_id",value:t.id??""}),e.jsx("input",{type:"hidden",name:"deadline",value:w}),e.jsxs("div",{className:"relative w-full h-auto mt-2",children:[e.jsx(R,{size:"large",total:t.amount,amount:m}),e.jsxs("p",{className:"absolute top-1/2 right-2 translate-y-[-50%] z-10 flex items-center justify-center gap-1 text-primary font-bold mix-blend-difference",children:[e.jsx(C,{price:m}),"/",e.jsx(C,{price:t.amount})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-start gap-4 mx-auto w-auto",children:[e.jsx(E,{inputName:"amount",className:"mt-8",onChange:f,onSave:y}),e.jsx(K,{goal_id:t.goal_id,category:1})]})]})]})]})}export{ne as default};
